{"version":3,"sources":["./src/app/gallery/gallery.page.html","./src/app/gallery/gallery-routing.module.ts","./src/app/gallery/gallery.module.ts","./src/app/gallery/gallery.page.scss","./src/app/gallery/gallery.page.ts","./src/app/services/photo.service.ts"],"names":[],"mappings":"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","file":"gallery-gallery-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-menu-button></ion-menu-button>\\n        </ion-buttons>\\n        <ion-title>Galeria de Fotos</ion-title>\\n    </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n\\n    <ion-grid>\\n        <ion-row>\\n            <ion-col size=\\\"6\\\" *ngFor=\\\"let photo of photoService.photos; index as position\\\">\\n                <ion-img src=\\\"{{ photo.base64 ? photo.base64 : photo.webviewPath }}\\\" (click)=\\\"showActionSheet(photo, position)\\\"></ion-img>\\n            </ion-col>\\n        </ion-row>\\n    </ion-grid>\\n\\n    <ion-fab vertical=\\\"bottom\\\" horizontal=\\\"center\\\" slot=\\\"fixed\\\">\\n        <ion-fab-button>\\n            <ion-icon name=\\\"camera\\\" (click)=\\\"photoService.addNewToGallery()\\\"></ion-icon>\\n        </ion-fab-button>\\n    </ion-fab>\\n\\n</ion-content>\"","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { GalleryPage } from './gallery.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: GalleryPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class GalleryPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { GalleryPageRoutingModule } from './gallery-routing.module';\n\nimport { GalleryPage } from './gallery.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    GalleryPageRoutingModule\n  ],\n  declarations: [GalleryPage]\n})\nexport class GalleryPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2dhbGxlcnkvZ2FsbGVyeS5wYWdlLnNjc3MifQ== */\"","import { Component, OnInit } from '@angular/core';\n\nimport { PhotoService } from '../services/photo.service';\n\nimport { ActionSheetController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-gallery',\n  templateUrl: './gallery.page.html',\n  styleUrls: ['./gallery.page.scss'],\n})\nexport class GalleryPage implements OnInit {\n\n  constructor(\n    public photoService: PhotoService,\n    public actionSheetController: ActionSheetController\n  ) { }\n\n  ngOnInit() {\n\n    this.photoService.loadSaved();\n  }\n\n  public async showActionSheet(photo, position) {\n    const actionSheet = await this.actionSheetController.create({\n      header: 'Photos',\n      buttons: [{\n        text: 'Apagar',\n        role: 'destructive',\n        icon: 'trash',\n        handler: () => {\n          this.photoService.deletePicture(photo, position);\n        }\n      }, {\n        text: 'Cancelar',\n        icon: 'close',\n        role: 'cancel',\n        handler: () => {\n          // Nothing to do, action sheet is automatically closed\n          }\n      }]\n    });\n    await actionSheet.present();\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { Plugins, CameraResultType, Capacitor, FilesystemDirectory, CameraPhoto, CameraSource } from '@capacitor/core';\n\nimport { Platform } from '@ionic/angular';\n\nconst { Camera, Filesystem, Storage } = Plugins;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PhotoService {\n\n  public photos: Photo[] = [];\n\n  private PHOTO_STORAGE = 'photos';\n\n  private platform: Platform;\n\n  constructor(platform: Platform) {\n    this.platform = platform;\n  }\n\n  // Método para obter a foto\n  public async addNewToGallery() {\n    // Tirar foto\n    const capturedPhoto = await Camera.getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n\n    // Salva foto no dispositivo\n    const savedImageFile: any = await this.savePicture(capturedPhoto);\n\n    // Exibe a foto\n    this.photos.unshift(savedImageFile);\n\n    Storage.set({\n      key: this.PHOTO_STORAGE,\n      value: this.platform.is('hybrid')\n        ? JSON.stringify(this.photos)\n        : JSON.stringify(this.photos.map(p => {\n          // Não salve a representação base64 dos dados da foto,\n          // já que ele já foi salvo no sistema de arquivos\n          const photoCopy = { ...p };\n          delete photoCopy.base64;\n\n          return photoCopy;\n        }))\n    });\n  }\n\n  // Método para salvar a foto\n  private async savePicture(cameraPhoto: CameraPhoto) {\n    // Converta foto no formato base64, exigido pela API do sistema de arquivos para salvar\n    const base64Data = await this.readAsBase64(cameraPhoto);\n\n    // Escreva o arquivo no diretório de dados\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFile = await Filesystem.writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n\n    if (this.platform.is('hybrid')) {\n      // Exiba a nova imagem reescrevendo o caminho 'file: //' para HTTP\n      // Detalhes: https://ionicframework.com/docs/building/webview#file-protocol\n      return {\n        filepath: savedFile.uri,\n        webviewPath: Capacitor.convertFileSrc(savedFile.uri),\n      };\n    } else {\n      // Use webPath para exibir a nova imagem em vez de base64, pois já está carregado na memória\n      return {\n        filepath: fileName,\n        webviewPath: cameraPhoto.webPath\n      };\n    }\n  }\n\n  // Busque a foto, leia como um binário e converta para o formato base64\n  private async readAsBase64(cameraPhoto: CameraPhoto) {\n\n    // \"hybrid\" irá detectar Cordova ou Capacitor\n    if (this.platform.is('hybrid')) {\n      // Leia o arquivo no formato base64\n      const file = await Filesystem.readFile({\n        path: cameraPhoto.path\n      });\n      return file.data;\n    } else {\n      // Busque a foto, leia como um binário e converta para o formato base64\n      const response = await fetch(cameraPhoto.webPath);\n      const blob = await response.blob();\n      return await this.convertBlobToBase64(blob) as string;\n    }\n  }\n\n  // Obtém a foto gravada no diretório\n  convertBlobToBase64 = (blob: Blob) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = reject;\n    reader.onload = () => {\n      resolve(reader.result);\n    };\n    reader.readAsDataURL(blob);\n  })\n\n  // Recuperar dados da matriz de fotos em cache\n  public async loadSaved() {\n    // Recuperar dados da matriz de fotos em cache\n    const photos = await Storage.get({ key: this.PHOTO_STORAGE });\n    this.photos = JSON.parse(photos.value) || [];\n\n    // Maneira mais fácil de detectar ao executar na web:\n    // \"quando a plataforma NÃO for híbrida, faça isso\"\n    if (!this.platform.is('hybrid')) {\n      // Exiba a foto lendo no formato base64\n      // tslint:disable-next-line: prefer-const\n      for (let photo of this.photos) {\n        // Leia os dados de cada foto salva no sistema de arquivos\n        const readFile = await Filesystem.readFile({\n          path: photo.filepath,\n          directory: FilesystemDirectory.Data\n        });\n\n        // Apenas plataforma da Web: salve a foto no campo base64\n        photo.base64 = `data:image/jpeg;base64,${readFile.data}`;\n      }\n    }\n  }\n\n  public async deletePicture(photo: Photo, position: number) {\n    // Remova esta foto da matriz de dados de referência Fotos\n    this.photos.splice(position, 1);\n\n    // Atualize o cache da matriz de fotos substituindo a matriz de fotos existente\n    Storage.set({\n      key: this.PHOTO_STORAGE,\n      value: JSON.stringify(this.photos)\n    });\n\n    // Excluir arquivo de foto do sistema de arquivos\n    const filename = photo.filepath\n      .substr(photo.filepath.lastIndexOf('/') + 1);\n\n    await Filesystem.deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n  }\n}\n\ninterface Photo {\n  filepath: string;\n  webviewPath: string;\n  base64?: string;\n}\n"],"sourceRoot":"webpack:///"}